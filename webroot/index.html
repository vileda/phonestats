<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>phonestats</title>
</head>
<body>
<h1>phonestats</h1>
<h3 id="incomingTotal">0</h3>
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="//cdn.jsdelivr.net/sockjs/1.0.0/sockjs.min.js"></script>
<script>
    $(function () {
        var wsPort = window.location.port === '' ? '' : ':' + window.location.port;
        var wsUrl = window.location.protocol + '//' + window.location.hostname + wsPort;
        var sock = new SockJS(wsUrl+'/socket');

        var displayedAggregate = {incomingTotal: 0};

        sock.onopen = function() {
            console.log('open');
        };

        sock.onmessage = function(e) {
            var aggregate = JSON.parse(e.data);
            if(aggregate.incomingTotal > displayedAggregate.incomingTotal) {
                $('#incomingTotal').text(aggregate.incomingTotal);
                displayedAggregate = aggregate;
            }
        };

        sock.onclose = function() {
            console.log('close');
        };

        var id = window.location.pathname.split('/');
        $.getJSON('/api/aggregate/dashboard/' + id[id.length - 1])
                .done(function(aggregate) {
                    $('#incomingTotal').text(aggregate.incomingTotal);
                });
    });
</script>
</body>
</html>